# ä½¿ç”¨è½»é‡çº§ Python é•œåƒ (CPU ç‰ˆæœ¬)
# å¦‚æœæœ‰ GPU éœ€æ±‚ï¼Œå¯ä»¥æ”¹ç”¨: nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04
FROM python:3.10-slim

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    ffmpeg \
    libsndfile1 \
    git \
    && rm -rf /var/lib/apt/lists/*

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£… Python ä¾èµ–
# ä½¿ç”¨æ¸…åé•œåƒåŠ é€Ÿï¼ˆä¸­å›½ç”¨æˆ·ï¼‰
RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æš´éœ² WebSocket ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["python3", "server.py"]

# ============================================
# ğŸ³ Docker é•œåƒé€‰æ‹©æŒ‡å—
# ============================================
# 
# 1ï¸âƒ£ æœ‰ NVIDIA GPU (æ¨è)
#    FROM nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04
#    - æ”¯æŒ CUDA åŠ é€Ÿ
#    - TTS/ASR æ¨ç†é€Ÿåº¦å¿« (å®æ—¶ç‡ >1.0)
#    - éœ€è¦å®‰è£… NVIDIA Docker Runtime
#    - è¿è¡Œ: docker compose up
#
# 2ï¸âƒ£ ä»… CPU (å¤‡é€‰)
#    FROM python:3.10-slim
#    - æ— éœ€ GPU
#    - æ¨ç†é€Ÿåº¦æ…¢ (å®æ—¶ç‡ ~0.3-0.5)
#    - é€‚åˆæµ‹è¯•/ä½è´Ÿè½½åœºæ™¯
#    - å»æ‰ docker-compose.yml ä¸­çš„ deploy.resources
#
# 3ï¸âƒ£ Apple Silicon Mac (M1/M2/M3)
#    FROM python:3.10-slim
#    - Docker Desktop ä¸æ”¯æŒ GPU é€ä¼ 
#    - å»ºè®®ç›´æ¥æœ¬åœ° Python ç¯å¢ƒè¿è¡Œ
#    - å¯ä½¿ç”¨ MPS (Metal Performance Shaders) åŠ é€Ÿ
#    - è¿è¡Œ: python3 server.py
#
# ============================================
